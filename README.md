# Amur: Fixing Multi-Resource Leaks Guided by Resource Flow Analysis

**Amur** is a system designed to automatically patch multi-resource leaks using warnings generated by various static analysis tools (SATs). This repository contains the code and experimental data for our ASE 2025 paper:  
**_"Amur: Fixing Multi-Resource Leaks Guided by Resource Flow Analysis"_**

## ğŸ“¦ Project Structure

```plaintext
Amur/
â”œâ”€â”€ amur_lim/                      # Patch results using Amur
â”‚   â”œâ”€â”€ checkerframework/
â”‚   â”œâ”€â”€ codeguru/
â”‚   â”œâ”€â”€ infer/
â”‚   â”œâ”€â”€ pmd/
â”‚   â”œâ”€â”€ spotbugs/
â”‚   â”œâ”€â”€ jleaks/
â”‚   â”œâ”€â”€ amur_lim_parser.py        # Main script for Amur patching
â”‚   â””â”€â”€ amur_lim.py               # Contains OPENAI_API_KEY
â”‚
â”œâ”€â”€ pure_llm/                      # Patch results using plain LLM (no Amur)
â”‚   â”œâ”€â”€ checkerframework/
â”‚   â”œâ”€â”€ codeguru/
â”‚   â”œâ”€â”€ infer/
â”‚   â”œâ”€â”€ pmd/
â”‚   â”œâ”€â”€ spotbugs/
â”‚   â”œâ”€â”€ jleaks/
â”‚   â”œâ”€â”€ pure_llm_parser.py        # Main script for LLM-only patching
â”‚   â””â”€â”€ pure_llm.py               # Contains OPENAI_API_KEY
â””â”€â”€ ...
```

## ğŸš€ How to Run

### 1. Unzip the Package  
Extract the provided ZIP file.

### 2. Set API Key  
Open the appropriate script depending on which patching mode you want to use:

- For **Amur-based patching**:  
  Set your `OPENAI_API_KEY` in `amur_lim/amur_lim.py`.

- For **LLM-only patching** (without Amur):  
  Set your key in `pure_llm/pure_llm.py`.

### 3. Update Paths in Parser Script

In either `amur_lim/amur_lim_parser.py` or `pure_llm/pure_llm_parser.py`, update the following:
- `base_folder`: Path to the patch results directory (e.g., `checkerframework_results/`)
- `dataset_folder`: Path to the NJR1 dataset (e.g., `june2020_dataset/`)

### 4. Run the Script

```bash
# For Amur-based patching
python amur_lim/amur_lim_parser.py

# For LLM-only patching
python pure_llm/pure_llm_parser.py
```

## ğŸ“ Folder Details

Each of the `amur_lim/` and `pure_llm/` directories contains patching results for six static analysis tools:

- `checkerframework/`
- `codeguru/`
- `infer/`
- `pmd/`
- `spotbugs/`
- `jleaks/`

Each tool subfolder includes:
- `GPT-4o/`, `GPT-4o-mini/`, `o1/`: Patch results by LLM variant
- `manual_result/`: Manually verified patch correctness

- `amur_lim/`: Uses Amur to guide patch generation  
- `pure_llm/`: Uses LLMs directly without Amur logic

## ğŸ” API Key Notice

An `OPENAI_API_KEY` is included in the codebase for peer review purposes. It will be removed after the review process is complete.
